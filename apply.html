<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15기 지원 페이지</title>

    <!--CSS-->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/apply.css">

    <link rel="shortcut icon" type="image/x-icon" href="./image/logo.svg">
</head>

<body>
    <!-- header -->
    <header>
        <img src="./image/logo.svg" class="header-img" alt="마이페이지" onclick="goHome()">
        <nav>
            <ul>
                <li><a href="./index.html" class="header-menu" id="header-about" onclick="changeFontColor()">ABOUT</a>
                </li>
                <li><a href="./member.html" class="header-menu" id="header-member" onclick="changeFontColor()">부원</a>
                </li>
                <li><a href="./activity.html" class="header-menu" id="header-activity"
                        onclick="changeFontColor()">활동</a></li>
                <li><a href="./qna.html" class="header-menu" id="header-qna" onclick="changeFontColor()">QNA</a></li>
                <li><button onclick="location.href='./guidelines.html'">15기 지원하기</button></li>
            </ul>
        </nav>
    </header>

    <!-- 
        DarkMode 
        <button id="darkModeBtn">Dark Mode</button>
    -->

    <!-- main -->
    <main>
        <div class="wrapper">
            <div class="support-page">

                <!-- title -->
                <section id="title-box">
                    <div id="sub-title">MSG 지원 페이지</div>
                    <div id="title">MSG 15기 지원하기</div>
                    <div id="message">다음 MSG 15기 부원의 주인공은 바로 거기에 있는 당신!🥰</div>
                </section>

                <!-- Support Form -->
                <img src="./image/apply/logo.png">
                <form id="support-form" action="#">
                    <fieldset class="support-box">
                        <ul>
                            <li class="form-control">
                                <label for="username">이름을 입력해주세요.<span class="impact">*</span></label><br>
                                <input type="text" id="username" placeholder="김미림" required>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="class-number">학번을 입력해주세요.<span class="impact">*</span></label><br>
                                <input type="text" id="class-number" placeholder="1100" required>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="phone">전화번호를 입력해주세요. (-기호는 빼주세요)<span class="impact">*</span></label><br>
                                <input type="tel" id="phone" placeholder="01012345678" required>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="mail">학교 이메일을 입력해주세요.</label><span class="impact">*</span><br>
                                <input type="email" id="mail" placeholder="s2400@e-mirim.hs.kr" required>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="motive">MSG를 지원하게 된 동기를 입력해주세요.<span class="impact">*</span></label><br>
                                <textarea type="text" id="motive" placeholder="500자 이내로 작성해주세요." required></textarea>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="strength">자신의 장점에 대해 입력해주세요.<span class="impact">*</span></label><br>
                                <textarea type="text" id="strength" placeholder="500자 이내로 작성해주세요." required></textarea>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="experience">실패 경험을 입력해주세요.<span class="impact">*</span></label><br>
                                <textarea type="text" id="experience" placeholder="500자 이내로 작성해주세요."
                                    required></textarea>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="definition">나를 한 마디로 정의하자면?<span class="impact">*</span></label><br>
                                <input type="text" id="definition" placeholder="20글자 이내로 작성해주세요." required>
                                <small class="error">필수 입력입니다.</small>
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                            <li class="form-control">
                                <label for="question">MSG에 대해 궁금한 점을 물어봐주세요!</label><br>
                                <input type="text" id="question" placeholder="필수사항이 아닙니다.">
                                <small class="wrong">잘못된 입력입니다.</small>
                            </li>
                        </ul>
                    </fieldset>
                    <fieldset id="button-box">
                        <button type="submit" id="submit-button" onclick="apply()">제출하기</button>
                    </fieldset>
                </form>

            </div>
        </div>
    </main>

    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="./js/apply.js"></script>
    <script>
        // HTML을 업데이트하여 질문과 답변을 표시하는 함수
        function apply() {
            let name = $('#username').val();
            let studentId = $('#class-number').val();
            let tel = $('#phone').val();
            let email = $('#mail').val();
            let purpose = $('#motive').val();
            let strengths = $('#strength').val();
            let failure = $('#experience').val();
            let definition = $('#definition').val();
            let question = $('#question').val();

            // 공백 확인
            if (name === '' ||
                studentId === '' ||
                tel === '' ||
                email === '' ||
                purpose === '' ||
                strengths === '' ||
                failure === '' ||
                definition === ''
            ) {
                console.log(name);
                console.log(studentId);
                console.log(tel);
                console.log(email);
                console.log(purpose);
                console.log(strengths);
                console.log(failure);
                console.log(definition);
                console.log(question);
                console.log("입력 필요한 것 있음");
            } else if (studentId.length !== 4) {
                console.log("학번이 4글자가 아닙니다.");
                const errorMessages = studentId.parentElement.querySelector('.wrong');
                errorMessages.style.display = 'block';
                input.style.bordercolor = 'black';             // 지금 이게 안됨
                input.style.color = 'black';
            }
            else if (tel.length !== 11 || typeof Number(tel) !== number) {
                console.log(typeof Number(tel));
                console.log("tel이 11글자가 아니거나 숫자만 있는 게 아닙니다");
            }
            else if (!email.match("@e-mirim.hs.kr")) {
                console.log("잘못된 이메일 형식");
            }
            else if (purpose.length > 500 ||
                strengths.length > 500 ||
                failure.length > 500) {
                console.log("500자 초과함");
            }
            else if (definition.length > 20) {
                console.log("20자 초과함");

            }
            else {
                let param = {
                    "name": name,
                    "studentId": studentId,
                    "tel": tel,
                    "email": email,
                    "purpose": purpose,
                    "strengths": strengths,
                    "failure": failure,
                    "definition": definition,
                    "question": question
                };

                $.ajax({
                    type: 'post',           // 타입 (get, post, put 등등)
                    url: `http://210.114.18.202:8081/support-form`,           // 요청할 서버url
                    async: true,            // 비동기화 여부 (default : true)
                    dataType: 'json',       // 데이터 타입 (html, xml, json, text 등등)
                    data: JSON.stringify(param),
                    contentType: "application/json",
                    success: async function (data) { // 결과 성공 콜백함수
                        location.href = `./applySubmit.html`;
                    }
                });
            }

        }
    </script>
</body>

</html>